不動産営業自動化SaaS『AI-Prophet』詳細開発指示書 (v1.4)

最終更新日: 2026年1月18日
現在のステータス: Phase 3 中盤完了（マルチテナント・マルチサイト基盤実装済み）

1. プロジェクトビジョン

不動産営業マンの最大の負担である「物件精査（ブツ出し）」と「長期の見込み客フォロー」を、生成AIとブラウザ拡張技術によって完全自動化する。営業マンが「普段通りポータルサイトを開くだけ」で、裏側でAIが全顧客への提案と法規制チェックを完結させるシステムを構築する。

2. 技術スタック（指定）

Frontend: Next.js (管理画面・ダッシュボード)

Backend: Firebase (Firestore, Functions, Auth, Hosting)

Infrastructure: Google Cloud Platform (GCP)

Project Policy: FirebaseプロジェクトとGoogle Cloudプロジェクトは同一ID (ai-prophet) で管理中。

Multi-tenancy (実装済み):

データ隔離: Firestoreへの保存時に companyId フィールドを付与するロジックを background.js に実装済み（現在はデモID demo-company-001 で稼働中）。

Browser Extension: Chrome Extension (Manifest V3 / Vanilla JS)

スクレイピング戦略: content.js に Strategy Pattern を適用し、ドメイン (hostname) ごとに抽出ロジックを自動で切り替えるアーキテクチャを採用。

AI: Gemini 1.5 Pro / Flash API (RAGおよび構造化データ抽出用)

Communication: LINE Messaging API

Payment: Stripe (月額サブスクリプション実装)

3. 現在の実装状況 (2026/01/18時点)

✅ 実装完了機能 (Prototype v1.4)

Firebase連携 (The Connect):

Firestoreへのデータ保存パイプライン稼働中。

マルチテナント対応: 保存データに companyId および siteType が自動付与される仕様へアップデート完了。

リッチデータ取得機能 (The Hand - Beta):

マルチサイト対応: content.js 内にドメイン別ルール辞書 (SCRAPING_RULES) を実装。ITANDI BB, REINS, モックサイトを自動判別して抽出するロジックが完成。

取得項目: タイトル, URL, 住所, 賃料, 間取り。

E2Eテスト:

mock_site.html を用いたデータ取得およびFirestoreへの正常保存（会社ID付き）を確認済み。

🚧 次回実装予定 (Phase 3 後半 - The Automation)

バックグラウンド自動巡回:

chrome.alarms API を使用し、一定間隔（例: 15分ごと）にトリガーを発火させる。

ユーザーが操作していなくても、裏側で指定URLを巡回して新着をチェックするロジックの実装。

4. 主要機能モジュール詳細

4.1. LINE要件解析・自動DB反映 (The Brain)

Status: 未着手

概要: 顧客LINEから希望条件をJSON化し、DBへ保存。

4.2. 分散型バックグラウンド・スクレイピング (The Hand)

Status: 基盤完成・自動化待ち

概要: 営業マンのブラウザを「情報の触手」とし、ログインが必要な業者サイトからデータを自動収集する。

実装済み: サイト別DOM抽出ロジック、データ送信、DB保存。

これから: chrome.offscreen または隠しタブを使用した自律的な巡回機能。

4.3. 宅建業法遵守：物件死活監視・価格改定検知 (The Compliance)

Status: 未着手

概要: 掲載終了検知と価格改定の履歴保存。

4.4. 共有物件データベース & AIマッチング (The Assets)

Status: データ蓄積開始

概要: companyId で区切られたDBに物件情報を集約。

これから: 営業マンへの通知機能とAIによる提案文生成。

5. エンジニアへの引き継ぎ事項 (重要)

現在のコードベースについて:

ai-prophet-extension フォルダにて開発中。

スクレイピング: content.js の SCRAPING_RULES オブジェクトに、新しい対応サイト（SUUMO, ATBB等）のセレクタを追加するだけで機能拡張が可能です。

DB構造: properties コレクションのドキュメントには必ず companyId が含まれています。クエリを投げる際は必ず where("companyId", "==", userCompanyId) を含めてください。

次回のタスク:

manifest.json に alarms 権限を追加してください。

background.js に chrome.alarms.create を実装し、定期的に巡回処理 (scrape_now メッセージの送信など) を行うスケジューラーを作成してください。