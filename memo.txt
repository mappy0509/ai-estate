不動産営業自動化SaaS『AI-Prophet』詳細開発指示書 (v1.3)

最終更新日: 2026年1月18日
現在のステータス: Phase 3 初期完了（詳細データ取得ロジック実装・テスト完了）

1. プロジェクトビジョン

不動産営業マンの最大の負担である「物件精査（ブツ出し）」と「長期の見込み客フォロー」を、生成AIとブラウザ拡張技術によって完全自動化する。営業マンが「普段通りポータルサイトを開くだけ」で、裏側でAIが全顧客への提案と法規制チェックを完結させるシステムを構築する。

2. 技術スタック（指定）

Frontend: Next.js (管理画面・ダッシュボード)

Backend: Firebase (Firestore, Functions, Auth, Hosting)

Infrastructure: Google Cloud Platform (GCP)

Project Policy: FirebaseプロジェクトとGoogle Cloudプロジェクトは同一ID (ai-prophet) で管理中。

API Management: Gemini API (Vertex AI API) の有効化やクォータ管理はGoogle Cloud Consoleで行うこと。

Multi-tenancy Strategy (重要):

データ隔離: すべてのドキュメント（properties, customers, users）に companyId フィールドを必須とし、企業単位でのデータ分離を徹底すること。

セキュリティルール: Firestore Security Rules により、ログインユーザーの companyId と一致するドキュメントのみ読み書き可能にする厳格なアクセス制御を実装すること。

Browser Extension: Chrome Extension (Manifest V3 / Vanilla JS)

開発方針: libs フォルダに firebase-*-compat.js を配置し、Service Worker (background.js) で importScripts を使用する構成を維持。

AI: Gemini 1.5 Pro / Flash API (RAGおよび構造化データ抽出用)

Communication: LINE Messaging API

Payment: Stripe (月額サブスクリプション実装)

3. 現在の実装状況 (2026/01/18時点)

✅ 実装完了機能 (Prototype v1.3)

Firebase連携 (The Connect):

ai-prophet プロジェクトとの接続およびFirestoreへのデータ保存（properties コレクション）が正常に稼働中。

リッチデータ取得機能 (The Hand - Beta):

content.js を関数化し、外部メッセージ (scrape_now) をトリガーに動作するエージェント型へ改修完了。

取得項目: タイトル、URLに加え、賃料 (rent)、住所 (address)、間取り (layout) のDOM抽出ロジックを実装済み。

モックサイト (mock_site.html) を用いたE2Eテストにて、データの取得・整形・保存・リスト表示の一連の流れを確認済み。

UI連携強化:

popup.js から content.js へのメッセージパッシング (sendMessage) を実装。スクリプト未注入時の自動注入 (executeScript) ロジックによるエラーハンドリングを追加。

🚧 次回実装予定 (Phase 3 後半)

実サイト対応 (The Hand - Production): ITANDI BB や REINS などの実際の業者間サイトのDOM構造に対応するため、サイトごとに抽出セレクタを切り替えるロジック（Strategy Pattern）の実装。

バックグラウンド自動巡回: ユーザーが操作していない裏側（Offscreen API等）で、検索条件に基づいたURLを巡回する機能の実装。

4. 主要機能モジュール詳細

4.1. LINE要件解析・自動DB反映 (The Brain)

概要: 顧客がLINEで送る曖昧な希望条件を解析し、検索条件として構造化する。

要件:

LINE Messaging APIで受信したトークをGemini APIに投下。

エリア、価格、間取り、こだわり条件（学区、駐車場台数、ペット可等）をJSON形式で抽出。

既存条件の更新: 「やっぱり〇〇が良い」といった追加・修正発言を判別し、Firebaseの顧客条件を自動更新する。

4.2. 分散型バックグラウンド・スクレイピング (The Hand)

概要: 営業マンのブラウザを「情報の触手」とし、ログインが必要な業者サイトからデータを自動収集する。

動作トリガー: REINS、ITANDI BB、ATBB等、特定ドメインのログイン/トップページ遷移を検知。

全自動検索ロジック:

Firebaseから全顧客の検索条件を読み込む。

手入力不要: 検索条件をURLパラメータ（GETリクエスト）に自動変換し、非表示のオフスクリーン（Offscreen API）で検索結果ページを巡回。

AIパース: HTML構造に依存せず、Geminiのマルチモーダル機能等を用いて「物件詳細」から必要情報を抽出。

4.3. 宅建業法遵守：物件死活監視・価格改定検知 (The Compliance)

概要: 「おとり物件」を排除し、価格改定という営業チャンスを逃さない。

要件:

掲載終了検知: DB内の「公開中」物件URLを定期的にバックグラウンド巡回。

「掲載終了」「成約済み」「404」等の文言をAIが検知した瞬間、即座にDBのステータスを更新し、LINE提案対象から除外。

価格改定検知: 同一物件の価格・条件に変更があった場合、変更履歴を記録。

通知トリガー: 価格が下がった場合、その物件を検討中の顧客へ「プライスダウン通知」をLINEで自動下書き（または送信）。

4.4. 共有物件データベース & AIマッチング (The Assets)

概要: 社内の誰かが一度取得した物件を資産化し、全営業マンの顧客へマッチング。

要件:

営業マンAが取得した物件を companyId を付与して 社内共通DBに保存。他社のデータとは完全に隔離すること。

営業マンB（同一 companyId）の担当客に条件が合致すれば、即座にBの管理画面に「提案候補」として表示。

目利きプロンプト: 山本氏（宅建士）の知見を反映し、物件のメリット・デメリットをAIが整理して提案文を生成。

5. エンジニアへの引き継ぎ事項 (重要)

現在のコードベースについて:

ai-prophet-extension フォルダにて開発中。

Firebase SDK: npmなどは使用せず、libs フォルダに firebase-*-compat.js を配置し、background.js 内で importScripts を使って読み込んでいます。この構成を変えずに機能拡張を行ってください。

Firestoreセキュリティ: 現在はテストモード（全許可）です。本番移行時には、request.auth.token.companyId == resource.data.companyId といった適切なセキュリティルールの設定が必要です。

次回のタスク:

現在の scrapePageData() 関数内のセレクタはモック用です。window.location.hostname に応じて実サイト（ITANDI BB等）用のセレクタに切り替えるロジックを追加してください。

background.js にて chrome.alarms 等を使用し、一定間隔で巡回トリガーを発火させるロジックの検討を始めてください。