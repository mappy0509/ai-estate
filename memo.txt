不動産営業自動化SaaS『AI-Prophet』詳細開発指示書 (v1.5)

最終更新日: 2026年1月18日
現在のステータス: Phase 3 中盤 - 自動巡回機能デバッグ中（一時中断）

1. プロジェクトビジョン

不動産営業マンの最大の負担である「物件精査（ブツ出し）」と「長期の見込み客フォロー」を、生成AIとブラウザ拡張技術によって完全自動化する。営業マンが「普段通りポータルサイトを開くだけ」で、裏側でAIが全顧客への提案と法規制チェックを完結させるシステムを構築する。

2. 技術スタック（指定）

Frontend: Next.js (管理画面・ダッシュボード)

Backend: Firebase (Firestore, Functions, Auth, Hosting)

Infrastructure: Google Cloud Platform (GCP)

Multi-tenancy: 実装済み（companyId によるデータ隔離）

Browser Extension: Chrome Extension (Manifest V3 / Vanilla JS)

Firebase SDK: firebase-*-compat.js による importScripts 構成。

AI: Gemini 1.5 Pro / Flash API

Communication: LINE Messaging API

3. 現在の実装状況 (2026/01/18時点)

✅ 実装完了機能

Firebase連携: Firestoreへのデータ保存パイプラインおよび companyId 付与ロジックの確立。

マルチサイト対応: content.js でドメイン別に抽出ルールを切り替える Strategy Pattern の実装。

自動巡回スケジューラー: chrome.alarms による定期的な巡回トリガー（1分間隔）の実装。

⚠️ 現在発生している課題（次回着手事項）

自動巡回時の安定性: background.js (v1.5) において、アラーム発火後のタブ生成・スクリプト注入・データ抽出のプロセスでエラーが発生中。

事象: タブは自動で開くが、解析完了・保存が成功する前にエラーが発生、またはタブが閉じるタイミングとの競合が発生している。

🚧 次回実装予定

自動巡回機能のデバッグ（最優先）: * chrome.tabs.sendMessage と content.js の応答、および executeScript の実行タイミングの完全な同期。

実サイト対応 (Phase 3 後半):

ITANDI BB 等の実ドメインにおけるセレクタの微調整。

バックグラウンドのステルス化:

ユーザーの作業を邪魔しないよう、Offscreen API等への移行検討。

4. 主要機能モジュール詳細（一部抜粋）

4.2. 分散型バックグラウンド・スクレイピング (The Hand)

Status: 自動化デバッグ中

概要: 営業マンのブラウザを「情報の触手」とし、特定ドメインのログイン/トップページ遷移を検知して自動収集。

課題: background.js からのメッセージングが Content Script 側で正しく受け取れていない、もしくは保存処理を待たずにタブが破棄されている可能性。

5. エンジニアへの引き継ぎ事項 (重要)

再開時のチェックポイント:

background.js (v1.5) の startPatrol() 関数内、chrome.tabs.sendMessage 付近のログを確認してください。

content.js が注入される前にメッセージが送信されていないか、あるいは mock_site.html の読み込み完了判定が適切かを確認すること。

エラーログ: 「Receiving end does not exist」または保存処理前のタブクローズが疑われます。

設定: manifest.json には alarms, scripting, storage 権限が含まれています。